<div class="container mx-auto p-4 space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <div>
      <h1 class="text-3xl font-bold">Meus Investimentos</h1>
      <p class="text-base-content/70">Gerencie seus ativos financeiros</p>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="card bg-base-100 shadow-sm">
    <div class="card-body">
      <div class="flex flex-col lg:flex-row gap-4">
        <!-- Search -->
        <div class="form-control flex-1">
          <input 
            type="text" 
            placeholder="Buscar por nome, ticker ou setor..." 
            class="input input-bordered w-full" 
            [ngModel]="searchTerm()"
            (ngModelChange)="searchTerm.set($event)"
          />
        </div>

        <!-- Asset Type Filter -->
        <div class="form-control min-w-48">
          <select 
            class="select select-bordered w-full"
            [ngModel]="selectedAssetType()"
            (ngModelChange)="selectedAssetType.set($event)"
          >
            <option value="ALL">Todos os Tipos</option>
            @for (assetType of assetTypes; track assetType) {
              <option [value]="assetType">{{ getAssetTypeLabel(assetType) }}</option>
            }
          </select>
        </div>

        <!-- Sort -->
        <div class="form-control min-w-48">
          <select 
            class="select select-bordered w-full"
            [ngModel]="sortBy()"
            (ngModelChange)="sortBy.set($event)"
          >
            <option value="name">Ordenar por Nome</option>
            <option value="ticker">Ordenar por Ticker</option>
            <option value="value">Ordenar por Valor</option>
            <option value="performance">Ordenar por Performance</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Investments Table -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body p-0">
      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th (click)="onSort('name')" class="cursor-pointer hover:bg-base-200">
                Nome {{ getSortIcon('name') }}
              </th>
              <th (click)="onSort('ticker')" class="cursor-pointer hover:bg-base-200">
                Ticker {{ getSortIcon('ticker') }}
              </th>
              <th>Tipo</th>
              <th>Quantidade</th>
              <th>PreÃ§o Compra</th>
              <th>PreÃ§o Atual</th>
              <th (click)="onSort('value')" class="cursor-pointer hover:bg-base-200">
                Valor Total {{ getSortIcon('value') }}
              </th>
              <th (click)="onSort('performance')" class="cursor-pointer hover:bg-base-200">
                Performance {{ getSortIcon('performance') }}
              </th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
            @for (investment of filteredAndSortedInvestments(); track investment.id) {
              <tr class="hover">
                <td>
                  <div>
                    <div class="font-semibold">{{ investment.name }}</div>
                    @if (investment.sector) {
                      <div class="text-sm opacity-70">{{ investment.sector }}</div>
                    }
                  </div>
                </td>
                <td class="font-mono font-semibold">{{ investment.ticker }}</td>
                <td>
                  <div class="badge badge-outline">{{ getAssetTypeLabel(investment.assetType) }}</div>
                </td>
                <td>{{ investment.quantity }}</td>
                <td>{{ formatCurrency(investment.purchasePrice) }}</td>
                <td>
                  @if (investment.currentPrice) {
                    {{ formatCurrency(investment.currentPrice) }}
                  } @else {
                    <span class="text-base-content/50">â€”</span>
                  }
                </td>
                <td class="font-semibold">
                  {{ formatCurrency(getCurrentValue(investment)) }}
                  <div class="text-sm opacity-70">
                    Investido: {{ formatCurrency(getTotalInvested(investment)) }}
                  </div>
                </td>
                <td>
                  @if (investment.currentPrice) {
                    <div [ngClass]="getPerformanceClass(getPerformance(investment))">
                      <div class="font-semibold">{{ formatPercentage(getPerformance(investment)) }}</div>
                      <div class="text-sm">{{ formatCurrency(getGainLoss(investment)) }}</div>
                    </div>
                  } @else {
                    <span class="text-base-content/50">â€”</span>
                  }
                </td>
                <td>
                  <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
                      â‹®
                    </div>
                    <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow">
                      <li><a>Editar</a></li>
                      <li><a>Ver Dividendos</a></li>
                      <li><a (click)="onDelete(investment)" class="text-error">Excluir</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="9" class="text-center py-8">
                  <div class="flex flex-col items-center gap-2">
                    <div class="text-4xl opacity-30">ðŸ“Š</div>
                    <p class="text-lg font-medium">Nenhum investimento encontrado</p>
                    <p class="text-sm opacity-70">
                      @if (searchTerm() || selectedAssetType() !== 'ALL') {
                        Tente ajustar os filtros ou adicione novos investimentos
                      } @else {
                        Comece adicionando seu primeiro investimento
                      }
                    </p>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Summary Stats -->
  @if (filteredAndSortedInvestments().length > 0) {
    <div class="stats stats-vertical lg:stats-horizontal shadow w-full">
      <div class="stat">
        <div class="stat-title">Total de Investimentos</div>
        <div class="stat-value text-primary">{{ filteredAndSortedInvestments().length }}</div>
      </div>
      
      <div class="stat">
        <div class="stat-title">Valor Total Investido</div>
        <div class="stat-value">
          {{ formatCurrency(getTotalInvestedAmount()) }}
        </div>
      </div>
      
      <div class="stat">
        <div class="stat-title">Valor Atual</div>
        <div class="stat-value">
          {{ formatCurrency(getTotalCurrentValue()) }}
        </div>
      </div>
      
      <div class="stat">
        <div class="stat-title">Ganho/Perda Total</div>
        <div class="stat-value" [ngClass]="getPerformanceClass(getTotalGainLoss())">
          {{ formatCurrency(getTotalGainLoss()) }}
        </div>
      </div>
    </div>
  }
</div>